---
import PlayerCard from './PlayerCard.astro';
import players from '../data/players.json';

// Sort: featured first, then by grad year, then alphabetically
const sortedPlayers = [...players].sort((a, b) => {
  if (a.featured && !b.featured) return -1;
  if (!a.featured && b.featured) return 1;
  if (a.gradYear !== b.gradYear) return a.gradYear - b.gradYear;
  return a.lastName.localeCompare(b.lastName);
});

// Group by grad year
const playersByYear = sortedPlayers.reduce((acc, player) => {
  const year = player.gradYear;
  if (!acc[year]) acc[year] = [];
  acc[year].push(player);
  return acc;
}, {} as Record<number, typeof players>);

const years = Object.keys(playersByYear).map(Number).sort();
---

<section id="roster" class="section-padding bg-white">
  <div class="container-narrow">
    <div class="text-center mb-12">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
        Our Roster
      </h2>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Meet the talented athletes of Stars National Walker. Click on a player to view their full recruiting profile.
      </p>
    </div>

    {years.map(year => (
      <div class="mb-12 last:mb-0">
        <div class="flex items-center gap-4 mb-6">
          <div class="bg-stars-blue text-white font-bold px-4 py-2 rounded-lg shadow-sm">
            Class of {year}
          </div>
          <div class="flex-1 h-px bg-gray-200"></div>
          <span class="text-gray-400 text-sm">
            {playersByYear[year].length} player{playersByYear[year].length !== 1 ? 's' : ''}
          </span>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          {playersByYear[year].map(player => (
            <PlayerCard {...player} />
          ))}
        </div>
      </div>
    ))}
  </div>
</section>
