---
import team from '../data/team.json';
import { buildCloudinaryUrl } from '../lib/cloudinary';

// Team images from Cloudinary (using team_1, team_2, etc. naming)
const teamImageIds = [
  'StarsNationalWalker/team_1',
  'StarsNationalWalker/team_2',
  'StarsNationalWalker/team_3',
  'StarsNationalWalker/team_4',
  'StarsNationalWalker/team_5',
];

const teamImages = teamImageIds.map(publicId =>
  buildCloudinaryUrl({
    publicId,
    width: 640,
    height: 640,
    crop: 'fill',
    quality: 'auto',
    format: 'auto',
    gravity: 'faces',
  })
);

// Fallback to local image
const fallbackImage = '/team.jpeg';
---

<section class="relative bg-stars-navy min-h-[80vh] flex items-center">
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-10">
    <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"none\" fill-rule=\"evenodd\"%3E%3Cg fill=\"%23ffffff\" fill-opacity=\"0.4\"%3E%3Cpath d=\"M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
  </div>

  <div class="container-narrow relative z-10 py-24 md:py-32">
    <div class="grid md:grid-cols-2 gap-12 items-center">
      <!-- Text Content -->
      <div class="text-center md:text-left">
        <div class="inline-flex items-center gap-2 bg-stars-blue/20 border border-stars-blue/30 rounded-full px-4 py-1.5 mb-6">
          <span class="text-stars-blue text-sm font-semibold">★</span>
          <span class="text-white text-sm font-medium">{team.division} Elite Travel Softball</span>
        </div>

        <h1 class="text-4xl md:text-6xl font-extrabold text-white mb-4">
          Stars National
          <span class="block text-stars-blue">Walker</span>
        </h1>

        <p class="text-lg md:text-xl text-white/70 mb-6">
          {team.description}
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
          <a href="#roster" class="btn-primary">
            View Roster
          </a>
          <a href="#contact" class="btn-secondary border-white text-white hover:bg-white hover:text-stars-navy">
            Contact Us
          </a>
        </div>

        <!-- Achievements -->
        {team.achievements.length > 0 && (
          <div class="mt-8 pt-8 border-t border-white/10">
            <p class="text-stars-blue text-sm font-medium mb-2">Recent Achievements</p>
            {team.achievements.map(achievement => (
              <p class="text-white/80 text-sm">★ {achievement}</p>
            ))}
          </div>
        )}
      </div>

      <!-- Team Images Carousel -->
      <div class="hidden md:flex justify-center items-center">
        <div class="relative w-full max-w-2xl aspect-[4/3]">
          {teamImages.map((imageUrl, index) => (
            <img
              src={imageUrl}
              alt={`Stars National Walker Team ${index + 1}`}
              class={`absolute inset-0 w-full h-full object-cover rounded-2xl shadow-2xl transition-opacity duration-1000 ${index === 0 ? 'opacity-100' : 'opacity-0'}`}
              data-carousel-image={index}
              onerror={`this.style.display='none';document.querySelector('[data-fallback-image]').style.display='block'`}
            />
          ))}
          <!-- Fallback local image if Cloudinary fails -->
          <img
            src={fallbackImage}
            alt="Stars National Walker Team"
            class="absolute inset-0 w-full h-full object-cover rounded-2xl shadow-2xl hidden"
            data-fallback-image
          />
        </div>
      </div>
    </div>
  </div>

  <!-- Scroll Indicator -->
  <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce">
    <a href="#roster" class="text-white/50 hover:text-white transition-colors">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
      </svg>
    </a>
  </div>
</section>

<script>
  // Rotate through team images
  const images = document.querySelectorAll('[data-carousel-image]') as NodeListOf<HTMLImageElement>;
  let currentIndex = 0;
  let loadedImages = 0;

  // Check if images load successfully
  images.forEach((img) => {
    img.addEventListener('load', () => {
      loadedImages++;
    });
  });

  // Start carousel if we have multiple loaded images
  setTimeout(() => {
    if (loadedImages > 0 && images.length > 1) {
      setInterval(() => {
        // Fade out current image
        images[currentIndex].classList.remove('opacity-100');
        images[currentIndex].classList.add('opacity-0');

        // Move to next image
        currentIndex = (currentIndex + 1) % images.length;

        // Fade in next image
        images[currentIndex].classList.remove('opacity-0');
        images[currentIndex].classList.add('opacity-100');
      }, 4000); // Change image every 4 seconds
    }
  }, 1000);
</script>

